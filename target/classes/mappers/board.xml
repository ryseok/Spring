<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- board.xml -->
<mapper namespace="board">

	<!-- 공통된(중복된) sql문 작성 -->
	<sql id="search">
		<if test="searchType != null">
			<choose>
				<when test="searchType=='t'.toString()">
					where title like '%'||#{keyword}||'%'
				</when>
				<when test="searchType=='c'.toString()">
					where content like '%'||#{keyword}||'%'
				</when>
				<when test="searchType=='w'.toString()">
					where writer like '%'||#{keyword}||'%'
				</when>
				<otherwise></otherwise>
			</choose>
		</if>
	</sql>


	<insert id="create">
		insert into tbl_board (bno,title,content,writer)
		values (tbl_board_seq.nextval, #{title}, #{content}, #{writer})
	</insert>

	<!-- 목록조회 -->
	<select id="listAll" resultType="BoardVO">
		select bno,title,content,writer,regdate,viewcnt
		from tbl_board
		order by bno desc
	</select>

	<!-- 목록조회(페이징) : 사용X ==> RowBounds객체로 대체 -->
	<select id="listPage" resultType="BoardVO">
		select bno,title,content,writer,regdate,viewcnt
		from (select bno,title,content,writer,regdate,viewcnt,rownum rn
		from (select bno,title,content,writer,regdate,viewcnt
		from tbl_board
		order by bno desc
		)
		)
		where rn between 11 and 20
	</select>

	<!-- 목록조회(페이징) -->
	<select id="listPage2" resultType="BoardVO">
		select bno,title,content,writer,regdate,viewcnt
		from tbl_board
		order by bno desc
	</select>

	<!-- 목록조회(페이징:MySQL) -->
	<select id="listPageMySql" resultType="BoardVO">
		select bno,title,content,writer,regdate,viewcnt
		from tbl_board
		order by bno desc
		limit 0, 10  <!-- 0:skip수 10:length 글번호:100~91 -->
		limit 10, 10  <!-- 10:skip수 10:length 글번호:90~81 -->
	</select>

	<!-- 만약 검색조건:타이틀, 검색어:오늘 
  	<select id="listSearch1">
     	select bno,title,content,writer,regdate,viewcnt
     	from tbl_board
     	where title like '%오늘%'
     	order by bno desc
  	</select>
  
   	만약 검색조건:내용, 검색어:화이팅
  	<select id="listSearch2">
     	select bno,title,content,writer,regdate,viewcnt
     	from tbl_board
     	where content like '%화이팅%'
     	order by bno desc
  	</select>
  
   	만약 검색조건:작성자, 검색어:길동 
  	<select id="listSearch3">
     	select bno,title,content,writer,regdate,viewcnt
     	from tbl_board
     	where writer like '%길동%'
     	order by bno desc
  	</select>
  	-->


	<select id="listSearch" resultType="BoardVO">
		select bno,title,content,writer,regdate,viewcnt,replycnt
		from tbl_board
		<include refid="search"></include>
		order by bno desc
	</select>

	<!-- 검색된 행의 전체 행 수 -->
	<select id="listSearchCount" resultType="int">
		select count(*)
		from tbl_board
		<include refid="search"></include>
	</select>

	<!-- 전체 행의 수 구하기 -->
	<select id="selectTotalCount" resultType="int">
		select count(*)
		from tbl_board
	</select>


	<!-- 특정 글번호 읽기 -->
	<select id="read" resultType="BoardVO">
		select bno,title,content,writer
		from tbl_board
		where bno=#{bno}
	</select>

	<!-- 특정 글번호 수정 -->
	<update id="update">
		update tbl_board
		set title=#{title}, content=#{content}, writer=#{writer}
		where bno=#{bno}
	</update>

	<!-- 특정 글번호 삭제 -->
	<delete id="delete">
		delete from tbl_board
		where bno=#{bno}
	</delete>
	
	<!--특정 게시물에 대한 댓글 카운터 증가 또는 감소-->
	<update id="updateReplyCnt">
		update tbl_board
		set replycnt = replycnt + #{amount}
		where bno=#{bno}
	</update>
	
	<!--게시물 읽을 때 마다 증가-->
	<update id="updateViewCnt">
		update tbl_board set viewcnt = viewcnt+1
		where bno=#{bno} 
	</update>
</mapper>


